{% extends "layout.jinja2" %}

{% block main %}
    <section class="filters">
        <div class="filters__header-block">
            <h2 class="filters__header">Фильтры</h2>
        </div>
        <form action="/search/chapter" method="POST">
            <div class="filter-range">
                <div class="label-box">
                    <label class="label-box__label" for="id_diploma">id диплома</label>
                </div>
                <div class="filter-box">
                    <label class="filter-box__label" for="from">от</label>
                    <input class="filter-box__input" type="text" id="min_id_diploma" name="min_id_diploma"
                           value="{{ params.get('min_id_diploma', '') }}">
                    <label class="filter-box__label" for="to">до</label>
                    <input class="filter-box__input" type="text" id="max_id_diploma" name="max_id_diploma"
                           value="{{ params.get('max_id_diploma', '') }}">
                </div>
            </div>

            <div class="filter-range">
                <div class="label-box">
                    <label class="label-box__label" for="id_diploma">id раздела</label>
                </div>
                <div class="filter-box">
                    <label class="filter-box__label" for="from">от</label>
                    <input class="filter-box__input" type="text" id="min_id" name="min_id"
                           value="{{ params.get('min_id', '') }}">
                    <label class="filter-box__label" for="to">до</label>
                    <input class="filter-box__input" type="text" id="max_id" name="max_id"
                           value="{{ params.get('max_id', '') }}">
                </div>
            </div>

            <div class="filter-range">
                <div class="label-box">
                    <label class="label-box__label" for="section_name">название раздела</label>
                </div>
                <div class="filter-box">
                    <input class="filter-box__input long-input" type="text" id="section_name" name="section_name"
                           value="{{ params.get('section_name', '') }}" placeholder="Введите название раздела">
                </div>
            </div>

            <div class="filter-range">
                <div class="label-box">
                    <label class="label-box__label" for="id_diploma">водность</label>
                </div>
                <div class="filter-box">
                    <label class="filter-box__label" for="from">от</label>
                    <input class="filter-box__input" type="text" id="min_water_content" name="min_water_content"
                           value="{{ params.get('min_water_content', '') }}">
                    <label class="filter-box__label" for="to">до</label>
                    <input class="filter-box__input" type="text" id="max_water_content" name="max_water_content"
                           value="{{ params.get('max_water_content', '') }}">
                </div>
            </div>

            <div class="filter-range">
                <div class="label-box">
                    <label class="label-box__label" for="id_diploma">слов</label>
                </div>
                <div class="filter-box">
                    <label class="filter-box__label" for="from">от</label>
                    <input class="filter-box__input" type="text" id="min_words" name="min_words"
                           value="{{ params.get('min_words', '') }}">
                    <label class="filter-box__label" for="to">до</label>
                    <input class="filter-box__input" type="text" id="max_words" name="max_words"
                           value="{{ params.get('max_words', '') }}">
                </div>
            </div>

            <div class="filter-range">
                <div class="label-box">
                    <label class="label-box__label" for="id_diploma">символов</label>
                </div>
                <div class="filter-box">
                    <label class="filter-box__label" for="from">от</label>
                    <input class="filter-box__input" type="text" id="min_symbols" name="min_symbols"
                           value="{{ params.get('min_symbols', '') }}">
                    <label class="filter-box__label" for="to">до</label>
                    <input class="filter-box__input" type="text" id="max_symbols" name="max_symbols"
                           value="{{ params.get('max_symbols', '') }}">
                </div>
            </div>

            <div class="filter-range">
                <div class="label-box">
                    <label class="label-box__label" for="words">часто употребляемые слова</label>
                </div>
                <div class="list-card">
                    <div class="filter-box">
                        <input class="filter-box__input append-input" type="text" id="words" name="words"
                               value="{{ params.get('words', '') }}" placeholder="Введите слово">
                        <button class="filter-box__add-word">
                            <i class="fa-solid fa-plus"></i>
                        </button>
                    </div>
                    <div class="list-words"></div>
                </div>
            </div>

            <div class="filter-range">
                <div class="label-box">
                    <label class="label-box__label" for="chapters">id дочерних разделов</label>
                </div>
                <div class="list-card">
                    <div class="filter-box">
                        <input class="filter-box__input append-input" type="text" id="chapters" name="chapters"
                               value="{{ params.get('chapters', '') }}" placeholder="Введите слово">
                        <button class="filter-box__add-word">
                            <i class="fa-solid fa-plus"></i>
                        </button>
                    </div>
                    <div class="list-words"></div>
                </div>
            </div>

            <button type="submit" class="search-button filters__header-block">Найти</button>
        </form>
    </section>

    <section class="results-block">
        <div class="sort-chapter">
            <div class="label-box_dark-light">
                <label class="label-box__label-sort" for="sort_by">без сортировки</label>
                <input type="hidden" name="order_by" id="order_by_input">
            </div>
            <button class="arrow-button" aria-label="Открыть/закрыть список">
                <i class="fa-solid fa-angle-down fa-2x arrow"></i>
            </button>
            <ul class="options-list">
                <li data-value="no_sort">без сортировки</li>
                <li data-value="id_asc">id диплома</li>
                <li data-value="year">год</li>
                <li data-value="pages">количество страниц</li>
                <li data-value="words">количество слов</li>
                <li data-value="upload_date">дата загрузки</li>
            </ul>
        </div>
        <!-- Блок с результатами -->
        <table class="results-block__table">
            <thead>
            <tr>
                <th>id диплома</th>
                <th>id раздела</th>
                <th>название раздела</th>
                <th>водность (%)</th>
                <th>слов (вкл.)</th>
                <th>символов (вкл.)</th>
                <th>топ часто встречающихся слов</th>
                <th>дочерние разделы (id)</th>
            </tr>
            </thead>
            <tbody>
            <!-- Здесь будут выводиться данные из базы данных -->
            {% for result in results %}
                <tr>
                    <td>{{ result.id_diploma }}</td>
                    <td>{{ result.id_section }}</td>
                    <td>{{ result.section_name }}</td>
                    <td>{{ result.water_content }}</td>
                    <td>{{ result.word_count }}</td>
                    <td>{{ result.symbol_count }}</td>
                    <td>{{ result.top_word }}</td>
                    <td>{{ result.child_sections }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </section>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const arrowButton = document.querySelector(".arrow-button");
            const optionsList = document.querySelector(".options-list");
            const labelSort = document.querySelector(".label-box__label-sort");
            const orderByInput = document.getElementById("order_by_input");
            const form = document.querySelector("form");

            arrowButton.addEventListener("click", function () {
                optionsList.classList.toggle("open");
                arrowButton.classList.toggle("open");
            });

            document.addEventListener("click", function (e) {
                if (!arrowButton.contains(e.target) && !optionsList.contains(e.target)) {
                    optionsList.classList.remove("open");
                    arrowButton.classList.remove("open");
                }
            });

            optionsList.addEventListener("click", function (e) {
                if (e.target.tagName === "LI") {
                    const selectedText = e.target.textContent;
                    const selectedValue = e.target.dataset.value;
                    labelSort.textContent = selectedText;
                    orderByInput.value = selectedValue;  // Ставим в скрытое поле
                    optionsList.classList.remove("open");
                    arrowButton.classList.remove("open");
                    form.submit();
                }
            });
        });
    </script>
{% endblock %}
